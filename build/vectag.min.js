!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.vectag=e():t.vectag=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="build/",n(n.s=1)}([function(t,e,n){t.exports=function(){"use strict";function t(t,i,r,a,o){!function t(n,i,r,a,o){for(;a>r;){if(a-r>600){var s=a-r+1,h=i-r+1,l=Math.log(s),u=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*u*(s-u)/s)*(h-s/2<0?-1:1);t(n,i,Math.max(r,Math.floor(i-h*u/s+f)),Math.min(a,Math.floor(i+(s-h)*u/s+f)),o)}var c=n[i],v=r,y=a;for(e(n,r,i),o(n[a],c)>0&&e(n,r,a);v<y;){for(e(n,v,y),v++,y--;o(n[v],c)<0;)v++;for(;o(n[y],c)>0;)y--}0===o(n[r],c)?e(n,r,y):e(n,++y,a),y<=i&&(r=y+1),i<=y&&(a=y-1)}}(t,i,r||0,a||t.length-1,o||n)}function e(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function n(t,e){return t<e?-1:t>e?1:0}var i=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function a(t,e){o(t,0,t.children.length,e,t)}function o(t,e,n,i,r){r||(r=y(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a=e;a<n;a++){var o=t.children[a];s(r,t.leaf?i(o):o)}return r}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function h(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function c(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function v(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function y(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(e,n,i,r,a){for(var o=[n,i];o.length;)if(!((i=o.pop())-(n=o.pop())<=r)){var s=n+Math.ceil((i-n)/r/2)*r;t(e,s,n,i,a),o.push(n,s,s,i)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(t){var e=this.data,n=[];if(!v(t,e))return n;for(var i=this.toBBox,r=[];e;){for(var a=0;a<e.children.length;a++){var o=e.children[a],s=e.leaf?i(o):o;v(t,s)&&(e.leaf?n.push(o):c(t,s)?this._all(o,n):r.push(o))}e=r.pop()}return n},i.prototype.collides=function(t){var e=this.data;if(!v(t,e))return!1;for(var n=[];e;){for(var i=0;i<e.children.length;i++){var r=e.children[i],a=e.leaf?this.toBBox(r):r;if(v(t,a)){if(e.leaf||c(t,a))return!0;n.push(r)}}e=n.pop()}return!1},i.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},i.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},i.prototype.clear=function(){return this.data=y([]),this},i.prototype.remove=function(t,e){if(!t)return this;for(var n,i,a,o=this.data,s=this.toBBox(t),h=[],l=[];o||h.length;){if(o||(o=h.pop(),i=h[h.length-1],n=l.pop(),a=!0),o.leaf){var u=r(t,o.children,e);if(-1!==u)return o.children.splice(u,1),h.push(o),this._condense(h),this}a||o.leaf||!c(o,s)?i?(n++,o=i.children[n],a=!1):o=null:(h.push(o),l.push(n),n=0,i=o,o=o.children[0])}return this},i.prototype.toBBox=function(t){return t},i.prototype.compareMinX=function(t,e){return t.minX-e.minX},i.prototype.compareMinY=function(t,e){return t.minY-e.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(t){return this.data=t,this},i.prototype._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},i.prototype._build=function(t,e,n,i){var r,o=n-e+1,s=this._maxEntries;if(o<=s)return a(r=y(t.slice(e,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),(r=y([])).leaf=!1,r.height=i;var h=Math.ceil(o/s),l=h*Math.ceil(Math.sqrt(s));d(t,e,n,l,this.compareMinX);for(var u=e;u<=n;u+=l){var f=Math.min(u+l-1,n);d(t,u,f,h,this.compareMinY);for(var c=u;c<=f;c+=h){var v=Math.min(c+h-1,f);r.children.push(this._build(t,c,v,i-1))}}return a(r,this.toBBox),r},i.prototype._chooseSubtree=function(t,e,n,i){for(;i.push(e),!e.leaf&&i.length-1!==n;){for(var r=1/0,a=1/0,o=void 0,s=0;s<e.children.length;s++){var h=e.children[s],l=u(h),f=(c=t,v=h,(Math.max(v.maxX,c.maxX)-Math.min(v.minX,c.minX))*(Math.max(v.maxY,c.maxY)-Math.min(v.minY,c.minY))-l);f<a?(a=f,r=l<r?l:r,o=h):f===a&&l<r&&(r=l,o=h)}e=o||e.children[0]}var c,v;return e},i.prototype._insert=function(t,e,n){var i=n?t:this.toBBox(t),r=[],a=this._chooseSubtree(i,this.data,e,r);for(a.children.push(t),s(a,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)},i.prototype._split=function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var o=this._chooseSplitIndex(n,r,i),s=y(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,a(n,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},i.prototype._splitRoot=function(t,e){this.data=y([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(t,e,n){for(var i,r,a,s,h,l,f,c=1/0,v=1/0,y=e;y<=n-e;y++){var d=o(t,0,y,this.toBBox),p=o(t,y,n,this.toBBox),m=(r=d,a=p,s=Math.max(r.minX,a.minX),h=Math.max(r.minY,a.minY),l=Math.min(r.maxX,a.maxX),f=Math.min(r.maxY,a.maxY),Math.max(0,l-s)*Math.max(0,f-h)),g=u(d)+u(p);m<c?(c=m,i=y,v=g<v?g:v):m===c&&g<v&&(v=g,i=y)}return i||n-e},i.prototype._chooseSplitAxis=function(t,e,n){var i=t.leaf?this.compareMinX:h,r=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)},i.prototype._allDistMargin=function(t,e,n,i){t.children.sort(i);for(var r=this.toBBox,a=o(t,0,e,r),h=o(t,n-e,n,r),l=f(a)+f(h),u=e;u<n-e;u++){var c=t.children[u];s(a,t.leaf?r(c):c),l+=f(a)}for(var v=n-e-1;v>=e;v--){var y=t.children[v];s(h,t.leaf?r(y):y),l+=f(h)}return l},i.prototype._adjustParentBBoxes=function(t,e,n){for(var i=n;i>=0;i--)s(e[i],t)},i.prototype._condense=function(t){for(var e=t.length-1,n=void 0;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children).splice(n.indexOf(t[e]),1):this.clear():a(t[e],this.toBBox)},i}()},function(t,e,n){t.exports=n(2)},function(t,e,n){"use strict";function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,h=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){h=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(h)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}n.r(e),n.d(e,"planets",(function(){return P})),n.d(e,"gameOfLife",(function(){return R})),n.d(e,"fish",(function(){return J})),n.d(e,"preyPredator",(function(){return ft}));var a=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.indexOf(e);i>-1?t.splice(i,1):n&&console.log("Impossible to remove element not present in array.")},o=function(t,e){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=i(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;a(t,s,r)}}catch(t){o.e(t)}finally{o.f()}},s=n(0),h=n.n(s);function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tree=new h.a}var e,n,i;return e=t,(n=[{key:"get",value:function(t,e,n,i){var r=this.tree.search({minX:t,minY:e,maxX:n,maxY:i});return r=r.map((function(t){return t.obj}))}},{key:"add",value:function(t,e,n){var i={minX:e,minY:n,maxX:e,maxY:n,obj:t};this.tree.insert(i)}},{key:"remove",value:function(t,e,n){var i={minX:e,minY:n,maxX:e,maxY:n,obj:t};this.tree.remove(i,(function(t,e){return t.obj===e.obj}))}},{key:"move",value:function(t,e,n,i,r){this.remove(t,e,n),this.add(t,i,r)}}])&&l(e.prototype,n),i&&l(e,i),t}();function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var v=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vadiv",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vacanvas",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;f(this,t);var o=document.getElementById(n);this.w=o.offsetWidth,this.h=o.offsetHeight,this.canvas=document.createElement("canvas"),this.canvas.id=i,this.canvas.width=this.w,this.canvas.height=this.h,o.appendChild(this.canvas),this.c2d=this.canvas.getContext("2d"),this.center=r||{x:.5*this.w,y:.5*this.h},this.ps=a;var s=!1;this.canvas.addEventListener("mousedown",(function(t){s=!0})),this.canvas.addEventListener("mousemove",(function(t){s&&e.pan(-t.movementX*e.ps,t.movementY*e.ps)})),this.canvas.addEventListener("mouseup",(function(t){s=!1}));var h=1.5;this.canvas.addEventListener("wheel",(function(t){var n=t.deltaY>0?h:1/h;e.zoom(n,e.pixToGeoX(t.offsetX),e.pixToGeoY(t.offsetY))}))}var e,n,i;return e=t,(n=[{key:"redraw",value:function(){return console.log("Override redraw method"),this}},{key:"geoToPixX",value:function(t){return(t-this.center.x)/this.ps+.5*this.w}},{key:"geoToPixY",value:function(t){return-(t-this.center.y)/this.ps+.5*this.h}},{key:"pixToGeoX",value:function(t){return(t-.5*this.w)*this.ps+this.center.x}},{key:"pixToGeoY",value:function(t){return-(t-.5*this.h)*this.ps+this.center.y}},{key:"pan",value:function(t,e){this.center.x+=t,this.center.y+=e,this.redraw()}},{key:"zoom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.center.x,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.center.y;this.ps*=t,this.center.x+=(e-this.center.x)*(1-t),this.center.y+=(n-this.center.y)*(1-t),this.redraw()}}])&&c(e.prototype,n),i&&c(e,i),t}();function y(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var m=function(){function t(e,n,i,r,a,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.u=e,this.m=n;var s=this.r();this.x=i<s?s:i>e.w-s?e.w-s:i,this.y=r<s?s:r>e.h-s?e.h-s:r,this.vx=a,this.vy=o,this.fx=0,this.fy=0}var e,n,i;return e=t,(n=[{key:"observe",value:function(){this.fx=0,this.fy=0;var t,e=y(this.u.ps);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(this!=n){var i=this.d(n);0!==i&&(i*=i*i,this.fx+=.01*(n.x-this.x)*this.m*n.m/i,this.fy+=.01*(n.y-this.y)*this.m*n.m/i)}}}catch(t){e.e(t)}finally{e.f()}}},{key:"d",value:function(t){var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)}},{key:"r",value:function(){return Math.pow(this.m/Math.PI,.5)}},{key:"change",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=this.fx/this.m,r=this.fy/this.m;if(this.vx+=i*n,this.vy+=r*n,e>0){var a=Math.sqrt(this.vx*this.vx+this.vy*this.vy);a>e&&(this.vx=e*this.vx/a,this.vy=e*this.vy/a)}var o=this.x+this.vx*n,s=this.y+this.vy*n;if(t){var h=this.r(),l=1;o<h&&(o=h,this.vx=-this.vx*l),s<h&&(s=h,this.vy=-this.vy*l),o>this.u.w-h&&(o=this.u.w-h,this.vx=-this.vx*l),s>this.u.h-h&&(s=this.u.h-h,this.vy=-this.vy*l)}else o<0&&(o=this.u.w),s<0&&(s=this.u.h),o>this.u.w&&(o=0),s>this.u.h&&(s=0);this.u.move(this,o,s)}},{key:"setRandomSpeed",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=2*Math.random()*Math.PI,i=t+Math.random()*(e-t);this.vx=i*Math.cos(n),this.vy=i*Math.sin(n)}},{key:"display",value:function(t,e){var n=t.c2d;n.fillStyle=e,n.beginPath(),n.arc(t.geoToPixX(this.x),t.geoToPixY(this.y),this.r()/t.ps,0,2*Math.PI),n.closePath(),n.fill()}}])&&p(e.prototype,n),i&&p(e,i),t}();function g(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function b(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var w=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=e,this.h=n,this.ps=[],this.grid=new u}var e,n,i;return e=t,(n=[{key:"m",value:function(){var t,e=0,n=g(this.ps);try{for(n.s();!(t=n.n()).done;)e+=t.value.m}catch(t){n.e(t)}finally{n.f()}return e}},{key:"createPlanet",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=new m(this,t,e,n,i,r);return this.add(a),a}},{key:"add",value:function(t){t.u=this,this.ps.push(t),this.grid.add(t,t.x,t.y)}},{key:"remove",value:function(t){t.u=null,a(this.ps,t),this.grid.remove(t,t.x,t.y)}},{key:"move",value:function(t,e,n){this.grid.move(t,t.x,t.y,e,n),t.x=e,t.y=n}},{key:"aggregate",value:function(t,e){var n=t.m+e.m,i=this.createPlanet(n,(t.x*t.m+e.x*e.m)/n,(t.y*t.m+e.y*e.m)/n,(t.vx*t.m+e.vx*e.m)/n,(t.vy*t.m+e.vy*e.m)/n);return this.remove(t),this.remove(e),i}},{key:"findCollision",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=g(this.ps);try{for(n.s();!(t=n.n()).done;){var i,r=t.value,a=2*r.r(),o=this.grid.get(r.x-a,r.y-a,r.x+a,r.y+a),s=g(o);try{for(s.s();!(i=s.n()).done;){var h=i.value;if(r!=h){var l=r.d(h),u=(r.r()+h.r())*e;if(!(l>u))return[r,h]}}}catch(t){s.e(t)}finally{s.f()}}}catch(t){n.e(t)}finally{n.f()}return null}},{key:"addPlanets",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,r=0;r<t;r++){var a=this.createPlanet(e,this.w*Math.random(),this.h*Math.random());a.setRandomSpeed(n,i)}return this}},{key:"step",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,a=g(this.ps);try{for(a.s();!(t=a.n()).done;){var o=t.value;o.observe()}}catch(t){a.e(t)}finally{a.f()}var s,h=g(this.ps);try{for(h.s();!(s=h.n()).done;){var l=s.value;l.change(e,n,r)}}catch(t){h.e(t)}finally{h.f()}for(var u=this.findCollision(i);null!==u;)this.aggregate(u[0],u[1]),u=this.findCollision(i);return this}},{key:"setRandomSpeed",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,i=g(this.ps);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.setRandomSpeed(e,n)}}catch(t){i.e(t)}finally{i.f()}return this}},{key:"getLargestPlanet",value:function(){var t,e=null,n=0,i=g(this.ps);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.m>n&&(e=r,n=r.m)}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"explodeLargestPlanet",value:function(){var t=this.getLargestPlanet();this.explode(t)}},{key:"explode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;if(e<=0&&(e=Math.floor(t.m)),!(e<=0)){for(var a=2*Math.PI/e,o=0;o<e;o++){r<0&&(r=2*t.r());var s=r*Math.random(),h=o*a,l=s*Math.cos(h),u=s*Math.sin(h),f=n+Math.random()*(i-n),c=h+2*(Math.random()-.5)*2*Math.PI/3,v=f*Math.cos(c),y=f*Math.sin(c);this.createPlanet(t.m/e,t.x+l,t.y+u,t.vx+v,t.vy+y)}this.remove(t)}}}])&&b(e.prototype,n),i&&b(e,i),t}();function M(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function S(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var A=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(e=e||{}).divId=e.divId||"vadiv";var n=document.getElementById(e.divId);this.w=e.w||n.offsetWidth,this.h=e.h||n.offsetHeight,this.cplus=new v(e.divId,"vacanvas"),this.cplus.c2d.fillStyle="black",this.cplus.c2d.fillRect(0,0,this.w,this.h);var i=this;this.cplus.redraw=function(){var t=this.c2d;t.fillStyle="rgba(0,0,0,0.05)",t.fillRect(0,0,i.w,i.h);var e,n=M(i.uni.ps);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=r.m/i.uni.m();r.display(this,"rgb(255,255,"+Math.floor(255*(1-a))+")")}}catch(t){n.e(t)}finally{n.f()}return t.strokeStyle="darkgray",t.beginPath(),t.rect(this.geoToPixX(0),this.geoToPixY(this.h),i.w/this.ps,i.h/this.ps),t.stroke(),this},this.uni=new w(this.w,this.h)}var e,n,i;return e=t,(n=[{key:"initRandom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return this.uni.ps=[],this.uni.addPlanets(t,e,n,i),this}},{key:"initBigBang",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.35,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.7,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100;this.uni.ps=[];var a=.5*this.w,o=.5*this.h,s=this.uni.createPlanet(t*e,a,o,0,0);return this.uni.explode(s,t,n,i,r),this}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,a=0,o=this,s=function s(){o.uni.step(t,e,n,i),o.cplus.redraw(),r>0&&a++>r||setTimeout(s,0)};return s(),this}},{key:"stop",value:function(){}}])&&S(e.prototype,n),i&&S(e,i),t}(),P=function(t){return new A(t)};function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _=function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;T(this,t),this.x=e,this.y=n,this.nb=i};function I(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Y=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=e,this.h=n,this.population=[],this.populationI={}}var e,n,i;return e=t,i=[{key:"getCellSurrounding",value:function(t,e){var n=0===t.x?e.w-1:t.x-1,i=t.x===e.w-1?0:t.x+1,r=0===t.y?e.h-1:t.y-1,a=t.y===e.h-1?0:t.y+1;return[new _(n,r),new _(n,t.y),new _(n,a),new _(t.x,r),new _(t.x,a),new _(i,r),new _(i,t.y),new _(i,a)]}}],(n=[{key:"add",value:function(t,e){var n=t+"_"+e;if(this.populationI[n])return null;var i=new _(t,e,0);return this.population.push(i),this.populationI[n]=i,i}},{key:"step",value:function(){var e,n={},i=I(this.population);try{for(i.s();!(e=i.n()).done;){var r,a=e.value,o=I(t.getCellSurrounding(a,this));try{for(o.s();!(r=o.n()).done;){var s=r.value,h=s.x+"_"+s.y,l=n[h];l?l.nb++:(s.nb=1,n[h]=s)}}catch(t){o.e(t)}finally{o.f()}}}catch(t){i.e(t)}finally{i.f()}var u,f=[],c={},v=I(this.population);try{for(v.s();!(u=v.n()).done;){var y=u.value,d=y.x+"_"+y.y,p=n[d];p&&(p.nb<2||p.nb>3||(f.push(y),c[d]=y))}}catch(t){v.e(t)}finally{v.f()}this.population=f,this.populationI=c;var m,g=I(function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e}(n));try{for(g.s();!(m=g.n()).done;){var x=m.value;if(3===x.nb){var b=x.x+"_"+x.y;this.populationI[b]||(this.population.push(x),this.populationI[b]=x)}}}catch(t){g.e(t)}finally{g.f()}return this}},{key:"start",value:function(t,e,n){var i=0,r=this;return function a(){r.step(),n.redraw(),t>0&&i++>t||setTimeout(a,e)}(),this}}])&&O(e.prototype,n),i&&O(e,i),t}();function j(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function B(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var C=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(e=e||{}).divId=e.divId||"vadiv";var n=document.getElementById(e.divId);this.w=n.offsetWidth,this.h=n.offsetHeight,this.cplus=new v(e.divId,"vacanvas");var i=this;this.cplus.redraw=function(){var t=this.c2d;t.fillStyle="white",t.fillRect(0,0,i.w,i.h),t.fillStyle="blue";var e,n=j(i.uni.population);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.fillRect(this.geoToPixX(r.x),this.geoToPixY(r.y),1/this.ps,1/this.ps)}}catch(t){n.e(t)}finally{n.f()}return t.strokeStyle="lightgray",t.beginPath(),t.rect(this.geoToPixX(0),this.geoToPixY(this.h),i.w/this.ps,i.h/this.ps),t.stroke(),this},this.uni=new Y(this.w,this.h)}var e,n,i;return e=t,(n=[{key:"initRandom",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.05,e=0,n=this.uni.w*this.uni.h*t;e<n;){var i=Math.round(this.uni.w*Math.random()),r=Math.round(this.uni.h*Math.random()),a=this.uni.add(i,r);a&&e++}return this}},{key:"start",value:function(){return this.uni.start(-1,0,this.cplus),this}}])&&B(e.prototype,n),i&&B(e,i),t}(),R=function(t){return new C(t)};function D(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return V(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var U=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.w*Math.random(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.h*Math.random(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;L(this,t),this.sea=e,this.x=n<0?0:n>e.w?e.w:n,this.y=i<0?0:i>e.h?e.h:i,this.vx=0,this.vy=0,r||a?(this.vx=r,this.vy=a,this.v=Math.hypot(r,a),this.va=Math.atan2(a,r)):this.setRandomSpeed(),this.ax=0,this.ay=0,this.sea.grid.add(this,this.x,this.y),this.obs=[],this.col=[]}var e,n,i;return e=t,(n=[{key:"setRandomSpeed",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sea.V_MAX;this.va=2*Math.random()*Math.PI,this.v=t+Math.random()*(e-t),this.vx=this.v*Math.cos(this.va),this.vy=this.v*Math.sin(this.va)}},{key:"observe",value:function(){this.obs=[],this.col=[];var t,e=D(this.sea.grid.get(this.x-this.sea.D_OBS,this.y-this.sea.D_OBS,this.x+this.sea.D_OBS,this.y+this.sea.D_OBS));try{for(e.s();!(t=e.n()).done;){var n=t.value;if(n!=this&&(this.d(n)<=this.sea.D_COL&&this.col.push(n),this.d(n)<=this.sea.D_OBS)){var i=Math.atan2(n.y-this.y,n.x-this.x)-this.va;if(i>Math.PI?i-=2*Math.PI:i<=-Math.PI&&(i+=2*Math.PI),(i=Math.abs(i))>.5*this.sea.A_OBS)continue;this.obs.push(n)}}}catch(t){e.e(t)}finally{e.f()}this.ax=0,this.ay=0;var r,a=D(this.col);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=this.d(o),h=1*(1/(s*s)-1/(this.sea.D_COL*this.sea.D_COL));this.ax+=h*(this.x-o.x)/s,this.ay+=h*(this.y-o.y)/s}}catch(t){a.e(t)}finally{a.f()}var l=.01*(this.sea.V_TARGET-this.v);this.ax+=l*this.vx/this.v,this.ay+=l*this.vy/this.v;var u=.9;if(this.obs.length>1){var f,c=0,v=0,y=D(this.obs);try{for(y.s();!(f=y.n()).done;){var d=f.value;c+=d.vx,v+=d.vy}}catch(t){y.e(t)}finally{y.f()}c=(u-1)*this.vx+(1-u)*c/this.obs.length,v=(u-1)*this.vy+(1-u)*v/this.obs.length,this.ax+=.1*c,this.ay+=.1*v}if(null!=this.sea.shark){var p=this.sea.shark,m=Math.hypot(p.x-this.x,p.y-this.y);if(m<=this.sea.D_OBS){var g=5*(1/(m*m)-1/(this.sea.D_OBS*this.sea.D_OBS));this.ax+=g*(this.x-p.x)/m,this.ay+=g*(this.y-p.y)/m}}}},{key:"move",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.sea.grid.remove(this,this.x,this.y),this.vx+=this.ax*t+.02*(1-2*Math.random()),this.vy+=this.ay*t+.02*(1-2*Math.random()),this.v=Math.hypot(this.vx,this.vy),this.va=Math.atan2(this.vy,this.vx),this.v>this.sea.V_MAX&&(this.v=this.sea.V_MAX,this.vx=this.sea.V_MAX*Math.cos(this.va),this.vy=this.sea.V_MAX*Math.sin(this.va)),this.x+=this.vx*t,this.y+=this.vy*t,this.x<0&&(this.x=this.sea.w),this.y<0&&(this.y=this.sea.h),this.x>this.sea.w&&(this.x=0),this.y>this.sea.h&&(this.y=0),this.sea.grid.add(this,this.x,this.y)}},{key:"d",value:function(t){return Math.hypot(t.x-this.x,t.y-this.y)}},{key:"display",value:function(t,e){var n=t.c2d,i=Math.floor(255*Math.abs(this.va)/Math.PI);n.strokeStyle="rgb(255, 255, "+i+")";var r=e/this.v,a=r*this.vx*.5,o=r*this.vy*.5;n.beginPath(),n.moveTo(t.geoToPixX(this.x-a),t.geoToPixY(this.y-o)),n.lineTo(t.geoToPixX(this.x+a),t.geoToPixY(this.y+o)),n.closePath(),n.stroke()}},{key:"displayVisionField",value:function(t,e,n){var i=t.c2d;i.fillStyle=e,i.lineWidth=n,i.beginPath(),i.moveTo(t.geoToPixX(this.x),t.geoToPixY(this.y)),i.arc(t.geoToPixX(this.x),t.geoToPixY(this.y),this.sea.D_OBS/t.ps,Math.PI-this.va+.5*this.sea.A_OBS,Math.PI-this.va-.5*this.sea.A_OBS),i.closePath(),i.fill()}},{key:"displayVisionLinks",value:function(t,e,n){var i=t.c2d;i.strokeStyle=e,i.lineWidth=n;var r,a=D(this.obs);try{for(a.s();!(r=a.n()).done;){var o=r.value;i.beginPath(),i.moveTo(t.geoToPixX(this.x),t.geoToPixY(this.y)),i.lineTo(t.geoToPixX(o.x),t.geoToPixY(o.y)),i.closePath(),i.stroke()}}catch(t){a.e(t)}finally{a.f()}}},{key:"displayCollisionField",value:function(t,e,n){var i=t.c2d;i.strokeStyle=e,i.lineWidth=n,i.beginPath(),i.arc(t.geoToPixX(this.x),t.geoToPixY(this.y),.5*this.sea.D_COL/t.ps,0,2*Math.PI),i.closePath(),i.stroke()}}])&&F(e.prototype,n),i&&F(e,i),t}();function $(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return H(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function W(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var G=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.D_OBS=50,this.A_OBS=200*Math.PI/180,this.D_COL=10,this.V_TARGET=.3,this.V_MAX=.6,this.D_SHARK_EAT=12,this.EATEN_SARDIN_NB=0,this.w=e,this.h=n,this.grid=new u,this.fish=[],this.shark=null,this.killed=[]}var e,n,i;return e=t,(n=[{key:"step",value:function(){var t,e=$(this.fish);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.observe()}}catch(t){e.e(t)}finally{e.f()}var i,r=$(this.fish);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.move()}}catch(t){r.e(t)}finally{r.f()}this.sharkEat()}},{key:"sharkEat",value:function(){if(null!=this.shark){this.killed=[];var t,e=this.shark.x,n=this.shark.y,i=$(this.grid.get(e-this.D_SHARK_EAT,n-this.D_SHARK_EAT,e+this.D_SHARK_EAT,n+this.D_SHARK_EAT));try{for(i.s();!(t=i.n()).done;){var r=t.value;Math.hypot(e-r.x,n-r.y)>this.D_SHARK_EAT||(this.killed.push(r),a(this.fish,r),this.grid.remove(r,r.x,r.y))}}catch(t){i.e(t)}finally{i.f()}return this.EATEN_SARDIN_NB+=this.killed.length,this}}},{key:"addFish",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)this.fish.push(new U(this));return this}},{key:"setRandomSpeed",value:function(){var t,e=$(this.fish);try{for(e.s();!(t=e.n()).done;)t.value.setRandomSpeed()}catch(t){e.e(t)}finally{e.f()}return this}}])&&W(e.prototype,n),i&&W(e,i),t}();function N(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function K(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var z=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(e=e||{}).divId=e.divId||"vadiv";var n=document.getElementById(e.divId);this.w=n.offsetWidth,this.h=n.offsetHeight,this.cplus=new v(e.divId,"vacanvas"),this.cplus.c2d.fillStyle="black",this.cplus.c2d.fillRect(0,0,this.w,this.h),this.showFishVisionField=!1,this.showFishVisionLinks=!1,this.showFishCollisionField=!1;var i=this;this.cplus.redraw=function(){var t=this.c2d,e=i.sea;if(t.fillStyle="rgba(120,120,255,0.6)",t.fillRect(0,0,i.w,i.h),i.showFishVisionField){var n,r=N(e.fish);try{for(r.s();!(n=r.n()).done;){n.value.displayVisionField(this,"rgba(200,200,200,0.15)",1)}}catch(t){r.e(t)}finally{r.f()}}if(i.showFishVisionLinks){var a,o=N(e.fish);try{for(o.s();!(a=o.n()).done;){a.value.displayVisionLinks(this,"rgba(255,100,100,0.3)",1)}}catch(t){o.e(t)}finally{o.f()}}if(i.showFishCollisionField){var s,h=N(e.fish);try{for(h.s();!(s=h.n()).done;){s.value.displayCollisionField(this,"purple",1)}}catch(t){h.e(t)}finally{h.f()}}t.lineWidth=2/this.ps;var l,u=N(e.fish);try{for(u.s();!(l=u.n()).done;){l.value.display(this,7)}}catch(t){u.e(t)}finally{u.f()}if(null!=e.shark){t.lineWidth=4/this.ps,t.strokeStyle="black";var f=12/this.ps,c=f*Math.cos(e.shark.angle),v=f*Math.sin(e.shark.angle);t.beginPath(),t.moveTo(this.geoToPixX(e.shark.x),this.geoToPixY(e.shark.y)),t.lineTo(this.geoToPixX(e.shark.x)-c,this.geoToPixY(e.shark.y)-v),t.closePath(),t.stroke()}t.fillStyle="red",t.lineWidth=1;var y,d=N(e.killed);try{for(d.s();!(y=d.n()).done;){var p=y.value;t.beginPath(),t.moveTo(this.geoToPixX(p.x),this.geoToPixY(p.y)),t.arc(this.geoToPixX(p.x),this.geoToPixY(p.y),4,0,2*Math.PI),t.closePath(),t.fill()}}catch(t){d.e(t)}finally{d.f()}return t.strokeStyle="darkgray",t.beginPath(),t.rect(this.geoToPixX(0)-3,this.geoToPixY(this.h)-3,i.w/this.ps+3,i.h/this.ps+3),t.stroke(),this},this.cplus.canvas.addEventListener("mouseover",(function(t){i.sea.shark={x:i.cplus.pixToGeoX(t.offsetX),y:i.cplus.pixToGeoY(t.offsetY),angle:0}})),this.cplus.canvas.addEventListener("mousemove",(function(t){var e=i.cplus.pixToGeoX(t.offsetX),n=i.cplus.pixToGeoY(t.offsetY),r=Math.atan2(-n+i.sea.shark.y,e-i.sea.shark.x);i.sea.shark={x:e,y:n,angle:r}})),this.cplus.canvas.addEventListener("mouseout",(function(t){i.sea.shark=null})),this.sea=new G(this.w,this.h)}var e,n,i;return e=t,(n=[{key:"initRandom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500;return this.sea.addFish(t),this}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=0,i=this,r=function r(){i.sea.step(t),i.cplus.redraw(),e>0&&n++>e||setTimeout(r,0)};return r(),this}}])&&K(e.prototype,n),i&&K(e,i),t}(),J=function(t){return new z(t)};function Q(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var nt=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;tt(this,t),this.type=e,this.l=n,this.x=i<0?0:i>n.w?n.w:i,this.y=r<0?0:r>n.h?n.h:r,this.vx=0,this.vy=0,this.predators=[],this.preys=[],n.grid.add(this,this.x,this.y)}var e,n,i;return e=t,(n=[{key:"d",value:function(t){return Math.hypot(t.x-this.x,t.y-this.y)}},{key:"move",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=this.l;e.grid.remove(this,this.x,this.y);var n=2*Math.random()*Math.PI,i=.01*Math.random();this.vx+=i*Math.cos(n)*t,this.vx=this.vx>e.V_MAX?e.V_MAX:this.vx<-e.V_MAX?-e.V_MAX:this.vx,this.vy+=i*Math.sin(n)*t,this.vy=this.vy>e.V_MAX?e.V_MAX:this.vy<-e.V_MAX?-e.V_MAX:this.vy,this.x+=this.vx*t,this.x=this.x<0?e.w:this.x>e.w?0:this.x,this.y+=this.vy*t,this.y=this.y<0?e.h:this.y>e.h?0:this.y,e.grid.add(this,this.x,this.y)}},{key:"observe",value:function(){var t=this.l,e=t.grid.get(this.x-t.d,this.y-t.d,this.x+t.d,this.y+t.d);this.preys=[],this.predators=[];var n,i=Q(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;r!=this&&(this.d(r)>t.d||(0==r.type?this.preys.push(r):this.predators.push(r)))}}catch(t){i.e(t)}finally{i.f()}}},{key:"makeChild",value:function(){return new t(this.type,this.l,this.x,this.y)}},{key:"display",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blue",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=n/t.ps;t.c2d.fillStyle=e,t.c2d.fillRect(t.geoToPixX(this.x),t.geoToPixY(this.y),i,i)}}])&&et(e.prototype,n),i&&et(e,i),t}();function it(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return rt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function at(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ot=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.V_MAX=.1,this.p=.02,this.q=.1,this.r=.5,this.nb=3,this.w=e,this.h=n,this.predators=[],this.preys=[],this.d=10,this.grid=new u}var e,n,i;return e=t,(n=[{key:"step",value:function(){var t,e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=it(this.preys);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.observe()}}catch(t){r.e(t)}finally{r.f()}var s,h=it(this.predators);try{for(h.s();!(s=h.n()).done;){var l=s.value;l.observe()}}catch(t){h.e(t)}finally{h.f()}var u,f=[],c=[],v=[],y=[],d=it(this.preys);try{for(d.s();!(u=d.n()).done;){var p=u.value;Math.random()>this.q||0==p.predators.length&&(p.preys.length>=this.nb||f.push(p.makeChild()))}}catch(t){d.e(t)}finally{d.f()}var m,g=it(this.predators);try{for(g.s();!(m=g.n()).done;){var x=m.value;if(0==x.preys.length)Math.random()<this.p&&y.push(x);else{var b=x.preys[Math.floor(x.preys.length*Math.random())];if(c.push(b),Math.random()>this.r)continue;if(x.predators.length>=this.nb)continue;v.push(x.makeChild())}}}catch(t){g.e(t)}finally{g.f()}(t=this.preys).push.apply(t,f),(e=this.predators).push.apply(e,v),o(this.preys,c,!1);for(var w=0,M=c;w<M.length;w++){var k=M[w];this.grid.remove(k,k.x,k.y,!1)}o(this.predators,y,!1);for(var S=0,A=y;S<A.length;S++){var P=A[S];this.grid.remove(P,P.x,P.y,!1)}var T,_=it(this.preys);try{for(_.s();!(T=_.n()).done;){var I=T.value;I.move(i)}}catch(t){_.e(t)}finally{_.f()}var X,O=it(this.predators);try{for(O.s();!(X=O.n()).done;){var Y=X.value;Y.move(i)}}catch(t){O.e(t)}finally{O.f()}}}])&&at(e.prototype,n),i&&at(e,i),t}();function st(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ht(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ht(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function lt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ut=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(e=e||{}).divId=e.divId||"vadiv";var n=document.getElementById(e.divId);this.w=n.offsetWidth,this.h=n.offsetHeight,this.cplus=new v(e.divId,"vacanvas"),this.cplus.c2d.fillStyle="white",this.cplus.c2d.fillRect(0,0,this.w,this.h);var i=this;this.cplus.redraw=function(){var t=this.c2d;t.fillStyle="rgba(255,255,255,0.5)",t.fillRect(0,0,i.w,i.h);var e,n=st(i.land.preys);try{for(n.s();!(e=n.n()).done;){e.value.display(this,"blue")}}catch(t){n.e(t)}finally{n.f()}var r,a=st(i.land.predators);try{for(a.s();!(r=a.n()).done;){r.value.display(this,"red")}}catch(t){a.e(t)}finally{a.f()}return t.strokeStyle="darkgray",t.beginPath(),t.rect(this.geoToPixX(0),this.geoToPixY(this.h),i.w/this.ps,i.h/this.ps),t.stroke(),this},this.land=new ot(this.w,this.h)}var e,n,i;return e=t,(n=[{key:"initRandom",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=0;n<t;n++)this.land.preys.push(new nt(0,this.land,this.w*Math.random(),this.h*Math.random()));for(var i=0;i<e;i++)this.land.predators.push(new nt(1,this.land,this.w*Math.random(),this.h*Math.random()));return this}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=0,i=this,r=function r(){i.land.step(t),i.cplus.redraw(),e>0&&n++>e||setTimeout(r,0)};return r(),this}}])&&lt(e.prototype,n),i&&lt(e,i),t}(),ft=function(t){return new ut(t)}}])}));