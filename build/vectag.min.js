!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.vectag=i():t.vectag=i()}(window,(function(){return function(t){var i={};function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="build/",e(e.s=0)}([function(t,i,e){t.exports=e(1)},function(t,i,e){"use strict";e.r(i),e.d(i,"planets",(function(){return p})),e.d(i,"gameOfLife",(function(){return w})),e.d(i,"fish",(function(){return C}));var n=function(t,i){var e=t.indexOf(i);e>-1?t.splice(e,1):console.log("Impossible to remove element not present in array.")};function s(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(i,e,n){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.res=n,this.lengthX=Math.floor(i/n+1),this.lengthY=Math.floor(e/n+1),this.cells=[];for(var s=0;s<this.lengthX;s++){this.cells[s]=[];for(var r=0;r<this.lengthY;r++)this.cells[s][r]=[]}}var i,e,r;return i=t,(e=[{key:"get",value:function(t,i,e,n){for(var s=[],r=Math.floor(t/this.res);r<Math.floor(e/this.res+1);r++)if(!(r<0||r>=this.lengthX))for(var h=Math.floor(i/this.res);h<Math.floor(n/this.res+1);h++)h<0||h>=this.lengthY||s.push.apply(s,this.cells[r][h]);return s}},{key:"add",value:function(t,i,e){return this.cells[Math.floor(i/this.res)][Math.floor(e/this.res)].push(t)}},{key:"remove",value:function(t,i,e){n(this.cells[Math.floor(i/this.res)][Math.floor(e/this.res)],t)}},{key:"move",value:function(t,i,e,s,r){var h=Math.floor(i/this.res),a=Math.floor(e/this.res),o=Math.floor(s/this.res),l=Math.floor(r/this.res);if(h!=o||a!=l)return n(this.cells[h][a],t),this.cells[o][l].push(t)}}])&&s(i.prototype,e),r&&s(i,r),t}();function h(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(){function t(i,e,n,s,r,h){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.u=i,this.m=e;var a=this.r();this.x=n<a?a:n>i.w-a?i.w-a:n,this.y=s<a?a:s>i.h-a?i.h-a:s,this.vx=r,this.vy=h}var i,e,n;return i=t,(e=[{key:"observe",value:function(){this.fx=0,this.fy=0;for(var t=0;t<this.u.ps.length;t++){var i=this.u.ps[t];if(this!=i){var e=this.d(i);0!==e&&(e*=e*e,this.fx+=.01*(i.x-this.x)*this.m*i.m/e,this.fy+=.01*(i.y-this.y)*this.m*i.m/e)}}}},{key:"d",value:function(t){var i=t.x-this.x,e=t.y-this.y;return Math.sqrt(i*i+e*e)}},{key:"r",value:function(){return Math.pow(this.m/Math.PI,.5)}},{key:"change",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.fx/this.m,s=this.fy/this.m;if(this.vx+=n*e,this.vy+=s*e,i>0){var r=Math.sqrt(this.vx*this.vx+this.vy*this.vy);r>i&&(this.vx=i*this.vx/r,this.vy=i*this.vy/r)}var h=this.x+this.vx*e,a=this.y+this.vy*e;if(t){var o=this.r(),l=1;h<o&&(h=o,this.vx=-this.vx*l),a<o&&(a=o,this.vy=-this.vy*l),h>this.u.w-o&&(h=this.u.w-o,this.vx=-this.vx*l),a>this.u.h-o&&(a=this.u.h-o,this.vy=-this.vy*l)}else h<0&&(h=this.u.w),a<0&&(a=this.u.h),h>this.u.w&&(h=0),a>this.u.h&&(a=0);this.u.move(this,h,a)}}])&&h(i.prototype,e),n&&h(i,n),t}();function o(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function l(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function t(i,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.min(i,e)/100;o(this,t),this.w=i,this.h=e,this.ps=[],this.grid=new r(i,e,n)}var i,e,s;return i=t,(e=[{key:"m",value:function(){for(var t=0,i=0;i<this.ps.length;i++)t+=this.ps[i].m;return t}},{key:"createPlanet",value:function(t,i,e,n,s){var r=new a(this,t,i,e,n,s);this.add(r)}},{key:"add",value:function(t){t.u=this,this.ps.push(t),this.grid.add(t,t.x,t.y)}},{key:"remove",value:function(t){t.u=null,n(this.ps,t),this.grid.remove(t,t.x,t.y)}},{key:"move",value:function(t,i,e){this.grid.move(t,t.x,t.y,i,e),t.x=i,t.y=e}},{key:"aggregate",value:function(t,i){var e=t.m+i.m,n=this.createPlanet(e,(t.x*t.m+i.x*i.m)/e,(t.y*t.m+i.y*i.m)/e,(t.vx*t.m+i.vx*i.m)/e,(t.vy*t.m+i.vy*i.m)/e);return this.remove(t),this.remove(i),n}},{key:"findCollision",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=0;i<this.ps.length;i++)for(var e=this.ps[i],n=2*e.r(),s=this.grid.get(e.x-n,e.y-n,e.x+n,e.y+n),r=0;r<s.length;r++){var h=s[r];if(e!=h){var a=e.d(h),o=(e.r()+h.r())*t;if(!(a>o))return[e,h]}}return null}},{key:"step",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;for(t=0;t<this.ps.length;t++)this.ps[t].observe();for(t=0;t<this.ps.length;t++)this.ps[t].change(i,e,s);for(var r=this.findCollision(n);null!==r;)this.aggregate(r[0],r[1]),r=this.findCollision(n)}}])&&l(i.prototype,e),s&&l(i,s),t}();function f(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function v(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=function(){function t(){var i=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vadiv",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vacanvas",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;f(this,t);var h=document.getElementById(e);this.w=h.offsetWidth,this.h=h.offsetHeight,this.canvas=document.createElement("canvas"),this.canvas.id=n,this.canvas.width=this.w,this.canvas.height=this.h,h.appendChild(this.canvas),this.c2d=this.canvas.getContext("2d"),this.center=s||{x:.5*this.w,y:.5*this.h},this.ps=r;var a=!1;this.canvas.addEventListener("mousedown",(function(t){a=!0})),this.canvas.addEventListener("mousemove",(function(t){a&&i.pan(-t.movementX*i.ps,t.movementY*i.ps)})),this.canvas.addEventListener("mouseup",(function(t){a=!1}));var o=1.5;this.canvas.addEventListener("wheel",(function(t){var e=t.deltaY>0?o:1/o;i.zoom(e,i.pixToGeoX(t.offsetX),i.pixToGeoY(t.offsetY))}))}var i,e,n;return i=t,(e=[{key:"redraw",value:function(){return console.log("Override redraw method"),this}},{key:"geoToPixX",value:function(t){return(t-this.center.x)/this.ps+.5*this.w}},{key:"geoToPixY",value:function(t){return-(t-this.center.y)/this.ps+.5*this.h}},{key:"pixToGeoX",value:function(t){return(t-.5*this.w)*this.ps+this.center.x}},{key:"pixToGeoY",value:function(t){return-(t-.5*this.h)*this.ps+this.center.y}},{key:"pan",value:function(t,i){this.center.x+=t,this.center.y+=i,this.redraw()}},{key:"zoom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.center.x,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.center.y;this.ps*=t,this.center.x+=(i-this.center.x)*(1-t),this.center.y+=(e-this.center.y)*(1-t),this.redraw()}}])&&v(i.prototype,e),n&&v(i,n),t}();function y(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),(i=i||{}).divId=i.divId||"vadiv";var e=document.getElementById(i.divId);this.w=e.offsetWidth,this.h=e.offsetHeight,this.cplus=new c(i.divId,"vacanvas"),this.cplus.c2d.fillStyle="black",this.cplus.c2d.fillRect(0,0,this.w,this.h);var n=this;this.cplus.redraw=function(){this.c2d.fillStyle="rgba(0,0,0,0.05)",this.c2d.fillRect(0,0,n.w,n.h);for(var t=0;t<n.uni.ps.length;t++){var i=n.uni.ps[t],e=i.m/n.uni.m();this.c2d.fillStyle="rgb(255,255,"+Math.floor(255*(1-e))+")",this.c2d.beginPath(),this.c2d.arc(this.geoToPixX(i.x),this.geoToPixY(i.y),i.r()/this.ps,0,2*Math.PI),this.c2d.closePath(),this.c2d.fill()}this.c2d.fillStyle="rgb(200,200,200)",this.c2d.fillRect(0,0,65,13),this.c2d.fillStyle="rgb(0,0,0)",this.c2d.fillText(n.uni.ps.length+" planets",2,10),this.c2d.strokeStyle="darkgray",this.c2d.beginPath(),this.c2d.rect(this.geoToPixX(0),this.geoToPixY(this.h),n.w/this.ps,n.h/this.ps),this.c2d.stroke()},this.uni=new u(this.w,this.h)}var i,e,n;return i=t,(e=[{key:"initRandom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;this.uni.ps=[];for(var s=0;s<t;s++){var r=e+Math.random()*(n-e),h=2*Math.random()*Math.PI;this.uni.createPlanet(i,this.w*Math.random(),this.h*Math.random(),r*Math.cos(h),r*Math.sin(h))}return this}},{key:"initBigBang",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.35,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.7,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100;this.uni.ps=[];for(var r=.5*this.w,h=.5*this.h,a=2*Math.PI/t,o=0;o<t;o++){var l=o*a,u=s*Math.random(),f=r+u*Math.cos(l),v=h+u*Math.sin(l),c=e+Math.random()*(n-e),y=l+2*(Math.random()-.5)*2*Math.PI/3,d=c*Math.cos(y),p=c*Math.sin(y);this.uni.createPlanet(i,f,v,d,p)}return this}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,r=0,h=this,a=function a(){h.uni.step(t,i,e,n),h.cplus.redraw(),s>0&&r++>s||setTimeout(a,0)};a()}},{key:"stop",value:function(){}}])&&y(i.prototype,e),n&&y(i,n),t}(),p=function(t){return new d(t)};function g(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var x=function(){function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=i,this.h=e,this.population=[],this.populationI={}}var i,e,n;return i=t,n=[{key:"getCellSurrounding",value:function(t,i){var e=0===t.x?i.w-1:t.x-1,n=t.x===i.w-1?0:t.x+1,s=0===t.y?i.h-1:t.y-1,r=t.y===i.h-1?0:t.y+1;return[{x:e,y:s},{x:e,y:t.y},{x:e,y:r},{x:t.x,y:s},{x:t.x,y:r},{x:n,y:s},{x:n,y:t.y},{x:n,y:r}]}}],(e=[{key:"add",value:function(t,i){var e=t+"_"+i;if(this.populationI[e])return null;var n={x:t,y:i,nb:0};return this.population.push(n),this.populationI[e]=n,n}},{key:"step",value:function(){var i,e,n,s,r,h,a,o={};for(i=0;i<this.population.length;i++){var l=t.getCellSurrounding(this.population[i],this);for(e=0;e<l.length;e++)(h=o[a=(r=l[e]).x+"_"+r.y])?h.nb++:(r.nb=1,o[a]=r)}var u=[],f={};for(i=0;i<this.population.length;i++)(s=o[a=(n=this.population[i]).x+"_"+n.y])&&(s.nb<2||s.nb>3||(u.push(n),f[a]=n));this.population=u,this.populationI=f;var v=function(t){var i=[];for(var e in t)t.hasOwnProperty(e)&&i.push(t[e]);return i}(o);for(i=0;i<v.length;i++)3===(r=v[i]).nb&&(a=r.x+"_"+r.y,(n=this.populationI[a])||(this.population.push(r),this.populationI[a]=r));return this}},{key:"start",value:function(t,i,e){var n=0,s=this;return function r(){s.step(),e.redraw(),t>0&&n++>t||setTimeout(r,i)}(),this}}])&&g(i.prototype,e),n&&g(i,n),t}();function m(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var b=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),(i=i||{}).divId=i.divId||"vadiv";var e=document.getElementById(i.divId);this.w=e.offsetWidth,this.h=e.offsetHeight,this.cplus=new c(i.divId,"vacanvas");var n=this;this.cplus.redraw=function(){this.c2d.clearRect(0,0,n.w,n.h),this.c2d.fillStyle="#0000FF";for(var t=0;t<n.uni.population.length;t++){var i=n.uni.population[t];this.c2d.fillRect(this.geoToPixX(i.x),this.geoToPixY(i.y),1/this.ps,1/this.ps)}this.c2d.strokeStyle="lightgray",this.c2d.beginPath(),this.c2d.rect(this.geoToPixX(0),this.geoToPixY(this.h),n.w/this.ps,n.h/this.ps),this.c2d.stroke()},this.uni=new x(this.w,this.h)}var i,e,n;return i=t,(e=[{key:"initRandom",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.05,i=0,e=this.uni.w*this.uni.h*t;i<e;){var n=Math.round(this.uni.w*Math.random()),s=Math.round(this.uni.h*Math.random()),r=this.uni.add(n,s);r&&i++}return this}},{key:"start",value:function(){this.uni.start(-1,0,this.cplus)}}])&&m(i.prototype,e),n&&m(i,n),t}(),w=function(t){return new b(t)};function k(t,i){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"==typeof t)return M(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return M(t,i)}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,h=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return h=t.done,t},e:function(t){a=!0,r=t},f:function(){try{h||null==e.return||e.return()}finally{if(a)throw r}}}}function M(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function P(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var T=function(){function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.D_OBS=50,this.A_OBS=200*Math.PI/180,this.D_COL=10,this.V_TARGET=.3,this.V_MAX=.6,this.D_SHARK_EAT=12,this.EATEN_SARDIN_NB=0,this.w=i,this.h=e,this.grid=new r(i,e,this.D_OBS),this.fish=[],this.shark=null,this.killed=[]}var i,e,s;return i=t,(e=[{key:"step",value:function(){var t,i=k(this.fish);try{for(i.s();!(t=i.n()).done;){var e=t.value;e.observe()}}catch(t){i.e(t)}finally{i.f()}var n,s=k(this.fish);try{for(s.s();!(n=s.n()).done;){var r=n.value;r.move()}}catch(t){s.e(t)}finally{s.f()}this.sharkEat()}},{key:"sharkEat",value:function(){if(null!=this.shark){this.killed=[];var t,i=this.shark.x,e=this.shark.y,s=k(this.grid.get(i-this.D_SHARK_EAT,e-this.D_SHARK_EAT,i+this.D_SHARK_EAT,e+this.D_SHARK_EAT));try{for(s.s();!(t=s.n()).done;){var r=t.value;Math.hypot(i-r.x,e-r.y)>this.D_SHARK_EAT||(this.killed.push(r),n(this.fish,r),this.grid.remove(r,r.x,r.y))}}catch(t){s.e(t)}finally{s.f()}this.EATEN_SARDIN_NB+=this.killed.length}}}])&&P(i.prototype,e),s&&P(i,s),t}();function S(t,i){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"==typeof t)return _(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _(t,i)}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,h=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return h=t.done,t},e:function(t){a=!0,r=t},f:function(){try{h||null==e.return||e.return()}finally{if(a)throw r}}}}function _(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function I(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function O(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var A=function(){function t(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.w*Math.random(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.h*Math.random(),s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;I(this,t),this.sea=i,this.x=e<0?0:e>i.w?i.w:e,this.y=n<0?0:n>i.h?i.h:n,s||r?(this.vx=s,this.vy=r,this.v=Math.hypot(s,r),this.va=Math.atan2(r,s)):(this.va=2*Math.random()*Math.PI-Math.PI,this.v=Math.random()*this.sea.V_MAX,this.vx=this.v*Math.cos(this.va),this.vy=this.v*Math.sin(this.va)),this.ax=0,this.ay=0,this.sea.grid.add(this,this.x,this.y),this.obs=[],this.col=[]}var i,e,n;return i=t,(e=[{key:"observe",value:function(){this.obs=[],this.col=[];var t,i=S(this.sea.grid.get(this.x-this.sea.D_OBS,this.y-this.sea.D_OBS,this.x+this.sea.D_OBS,this.y+this.sea.D_OBS));try{for(i.s();!(t=i.n()).done;){var e=t.value;if(e!=this&&(this.d(e)<=this.sea.D_COL&&this.col.push(e),this.d(e)<=this.sea.D_OBS)){var n=Math.atan2(e.y-this.y,e.x-this.x)-this.va;if(n>Math.PI?n-=2*Math.PI:n<=-Math.PI&&(n+=2*Math.PI),(n=Math.abs(n))>.5*this.sea.A_OBS)continue;this.obs.push(e)}}}catch(t){i.e(t)}finally{i.f()}this.ax=0,this.ay=0;var s,r=S(this.col);try{for(r.s();!(s=r.n()).done;){var h=s.value,a=this.d(h),o=1*(1/(a*a)-1/(this.sea.D_COL*this.sea.D_COL));this.ax+=o*(this.x-h.x)/a,this.ay+=o*(this.y-h.y)/a}}catch(t){r.e(t)}finally{r.f()}var l=.01*(this.sea.V_TARGET-this.v);this.ax+=l*this.vx/this.v,this.ay+=l*this.vy/this.v;var u=.9;if(this.obs.length>1){var f,v=0,c=0,y=S(this.obs);try{for(y.s();!(f=y.n()).done;){var d=f.value;v+=d.vx,c+=d.vy}}catch(t){y.e(t)}finally{y.f()}v=(u-1)*this.vx+(1-u)*v/this.obs.length,c=(u-1)*this.vy+(1-u)*c/this.obs.length,this.ax+=.1*v,this.ay+=.1*c}if(null!=this.sea.shark){var p=this.sea.shark,g=Math.hypot(p.x-this.x,p.y-this.y);if(g<=this.sea.D_OBS){var x=5*(1/(g*g)-1/(this.sea.D_OBS*this.sea.D_OBS));this.ax+=x*(this.x-p.x)/g,this.ay+=x*(this.y-p.y)/g}}}},{key:"move",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.sea.grid.remove(this,this.x,this.y),this.vx+=this.ax*t+.02*(1-2*Math.random()),this.vy+=this.ay*t+.02*(1-2*Math.random()),this.v=Math.hypot(this.vx,this.vy),this.va=Math.atan2(this.vy,this.vx),this.v>this.sea.V_MAX&&(this.v=this.sea.V_MAX,this.vx=this.sea.V_MAX*Math.cos(this.va),this.vy=this.sea.V_MAX*Math.sin(this.va)),this.x+=this.vx*t,this.y+=this.vy*t,this.x<0&&(this.x=this.sea.w),this.y<0&&(this.y=this.sea.h),this.x>this.sea.w&&(this.x=0),this.y>this.sea.h&&(this.y=0),this.sea.grid.add(this,this.x,this.y)}},{key:"d",value:function(t){return Math.hypot(t.x-this.x,t.y-this.y)}}])&&O(i.prototype,e),n&&O(i,n),t}();function E(t,i){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"==typeof t)return X(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return X(t,i)}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,h=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return h=t.done,t},e:function(t){a=!0,r=t},f:function(){try{h||null==e.return||e.return()}finally{if(a)throw r}}}}function X(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function j(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Y=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),(i=i||{}).divId=i.divId||"vadiv";var e=document.getElementById(i.divId);this.w=e.offsetWidth,this.h=e.offsetHeight,this.cplus=new c(i.divId,"vacanvas"),this.cplus.c2d.fillStyle="black",this.cplus.c2d.fillRect(0,0,this.w,this.h),this.fishView=!1,this.fishHalo=!1;var n=this;this.cplus.redraw=function(){var t=this.c2d,i=n.sea;t.fillStyle="rgba(120,120,255,0.6)",t.fillRect(0,0,n.w,n.h),t.lineWidth=2/this.ps;var e,s=E(i.fish);try{for(s.s();!(e=s.n()).done;){var r=e.value,h=Math.floor(255*Math.abs(r.va)/Math.PI);t.strokeStyle="rgb(255, 255, "+h+")";var a=7/r.v,o=a*r.vx*.5,l=a*r.vy*.5;t.beginPath(),t.moveTo(this.geoToPixX(r.x-o),this.geoToPixY(r.y-l)),t.lineTo(this.geoToPixX(r.x+o),this.geoToPixY(r.y+l)),t.closePath(),t.stroke()}}catch(t){s.e(t)}finally{s.f()}if(n.fishView){t.fillStyle="rgba(255,255,255,0.3)",t.lineWidth=1;var u,f=E(i.fish);try{for(f.s();!(u=f.n()).done;){var v=u.value;t.beginPath(),t.moveTo(this.geoToPixX(v.x),this.geoToPixY(v.y)),t.arc(this.geoToPixX(v.x),this.geoToPixY(v.y),i.D_OBS/this.ps,v.va-.5*i.A_OBS,v.va+.5*i.A_OBS),t.closePath(),t.fill()}}catch(t){f.e(t)}finally{f.f()}t.strokeStyle="rgb(255,0,255)",t.lineWidth=.5;var c,y=E(i.fish);try{for(y.s();!(c=y.n()).done;){var d,p=c.value,g=E(p.obs);try{for(g.s();!(d=g.n()).done;){var x=d.value;t.beginPath(),t.moveTo(this.geoToPixX(p.x),this.geoToPixY(p.y)),t.lineTo(this.geoToPixX(x.x),this.geoToPixY(x.y)),t.closePath(),t.stroke()}}catch(t){g.e(t)}finally{g.f()}}}catch(t){y.e(t)}finally{y.f()}}if(n.fishHalo){t.strokeStyle="red",t.lineWidth=1;var m,b=E(i.fish);try{for(b.s();!(m=b.n()).done;){var w=m.value;t.beginPath(),t.arc(this.geoToPixX(w.x),this.geoToPixY(w.y),.5*i.D_COL/this.ps,0,2*Math.PI),t.closePath(),t.stroke()}}catch(t){b.e(t)}finally{b.f()}}if(null!=i.shark){t.lineWidth=4/this.ps,t.strokeStyle="black";var k=12/this.ps,M=k*Math.cos(i.shark.angle),P=k*Math.sin(i.shark.angle);t.beginPath(),t.moveTo(this.geoToPixX(i.shark.x),this.geoToPixY(i.shark.y)),t.lineTo(this.geoToPixX(i.shark.x)-M,this.geoToPixY(i.shark.y)-P),t.closePath(),t.stroke()}t.fillStyle="red",t.lineWidth=1;var T,S=E(i.killed);try{for(S.s();!(T=S.n()).done;){var _=T.value;t.beginPath(),t.moveTo(this.geoToPixX(_.x),this.geoToPixY(_.y)),t.arc(this.geoToPixX(_.x),this.geoToPixY(_.y),4,0,2*Math.PI),t.closePath(),t.fill()}}catch(t){S.e(t)}finally{S.f()}t.strokeStyle="darkgray",t.beginPath(),t.rect(this.geoToPixX(0)-3,this.geoToPixY(this.h)-3,n.w/this.ps+3,n.h/this.ps+3),t.stroke()},this.cplus.canvas.addEventListener("mouseover",(function(t){n.sea.shark={x:n.cplus.pixToGeoX(t.offsetX),y:n.cplus.pixToGeoY(t.offsetY),angle:0}})),this.cplus.canvas.addEventListener("mousemove",(function(t){var i=n.cplus.pixToGeoX(t.offsetX),e=n.cplus.pixToGeoY(t.offsetY),s=Math.atan2(e-n.sea.shark.y,i-n.sea.shark.x);n.sea.shark={x:i,y:e,angle:s}})),this.cplus.canvas.addEventListener("mouseout",(function(t){n.sea.shark=null})),this.sea=new T(this.w,this.h)}var i,e,n;return i=t,(e=[{key:"initRandom",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,i=0;i<t;i++)this.sea.fish.push(new A(this.sea));return this}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,e=0,n=this,s=function s(){n.sea.step(t),n.cplus.redraw(),i>0&&e++>i||setTimeout(s,0)};s()}}])&&j(i.prototype,e),n&&j(i,n),t}(),C=function(t){return new Y(t)}}])}));