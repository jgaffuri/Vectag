var m=m||{};
$(function(){(function(e,n){e.h=function(a,d){this.f=a;this.d=d;this.b=[];this.e={};this.add=function(b,c){var a=b+"_"+c,d=this.e[a];if(d)return null;d=new e.a(b,c);this.b.push(d);return this.e[a]=d};this.j=function(){for(var b=0,c=this.f*this.d*.2;b<c;)this.add(Math.round(this.f*Math.random()),Math.round(this.d*Math.random()))&&b++;return this};this.g=function(b){b.clearRect(0,0,b.canvas.width,b.canvas.height);b.fillStyle="#0000FF";for(var c=0;c<this.b.length;c++){var a=this.b[c];b.fillRect(a.x,a.y,
1,1)}return this};this.step=function(){var b,c,a,d,g={};for(b=0;b<this.b.length;b++)for(var f=this.b[b].k(this),h=0;h<f.length;h++)c=f[h],d=c.getKey(),(a=g[d])?a.c++:(c.c=1,g[d]=c);f=[];h={};for(b=0;b<this.b.length;b++)c=this.b[b],d=c.getKey(),!(a=g[d])||2>a.c||3<a.c||(f.push(c),h[d]=c);this.b=f;this.e=h;a=e.l(g);for(b=0;b<a.length;b++)c=a[b],3===c.c&&(c.c=0,this.b.push(c),this.e[c.getKey()]=c);return this};this.start=function(a,c,d){function e(){console.log(g);f.step();f.g(d);g++>a||setTimeout(e,
c)}var g=0,f=this;e();return this}};e.a=function(a,d){this.x=a;this.y=d;this.c=0};e.a.prototype.k=function(a){var d=0===this.x?a.f-1:this.x-1,b=this.x===a.f-1?0:this.x+1,c=0===this.y?a.d-1:this.y-1;a=this.y===a.d-1?0:this.y+1;return[new e.a(d,c),new e.a(d,this.y),new e.a(d,a),new e.a(this.x,c),new e.a(this.x,a),new e.a(b,c),new e.a(b,this.y),new e.a(b,a)]};e.a.prototype.getKey=function(){return this.x+"_"+this.y};e.i=function(a,d){if(d.offsetX&&d.offsetY)return{x:d.offsetX,y:d.offsetY};var b=0,c=
0;do b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop;while(a=a.offsetParent);return{x:d.pageX-b,y:d.pageY-c}};e.l=function(a){var d=[],b;for(b in a)a.hasOwnProperty(b)&&d.push(a[b]);return d};var k=n("#cdiv"),p=k.width(),k=k.height(),q=document.getElementById("canvas"),l=q.getContext("2d");l.canvas.width=p;l.canvas.height=k;n("#canvas").click(function(a){console.log(e.i(q,a))});(new e.h(p,k)).j().g(l).start(500,1,l)})(m,$)});
